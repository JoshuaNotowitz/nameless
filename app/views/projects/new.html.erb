<h1>Create a Project</h1>

<%= form_for(@project, url: user_projects_path, class: "form-horizontal") do |p| %>
  <div class = "form-group">
    <%= p.label(:name, "Name", class: "control-label")%>
    <%= p.text_field(:name, autofocus: true, class: "form-control" , placeholder: "bike shop, tech company, produce store")%>
  </div>
  <div class = "form-group">
    <%= p.label(:description, "Description", class: "control-label")%>
    <%= p.text_field(:description, autofocus: true, class: "form-control" )%>
  </div>

  <%= p.hidden_field(:photo_url, id: "url" ) %>


  <span class="btn btn-default btn-file">Browse <input type="file" id="fileUploader"></span>
  <button class="btn btn-default" id="fileUploadBtn">Submit</button>
  <img id="pic" src="" height="300" width="300">

  <%= p.submit("Add Project", class: "btn btn-lg btn-info") %>

<% end %>


<script>  /// photo uploading

$(document).ready(function() {

    var parseAPPID = "WaIQr0ALAedB6JhACwDdqAJXN5m0kBizefvqIRMd";
    var parseJSID = "JWFUQveemVMqiwfgLY5GVDrjCF9t3HQpv1wvE0Z1";

    //Initialize Parse
    Parse.initialize(parseAPPID,parseJSID);
    $("#fileUploadBtn").on("click", function(e) {
      event.preventDefault();

        var fileUploadControl = $("#fileUploader")[0];
        if (fileUploadControl.files.length > 0) {
            var file = fileUploadControl.files[0];
            var name = "photo.jpg";

            console.log("here goes nothing...");
            $('#pic').attr('src', "<%= image_path('loader.gif') %>");

            var parseFile = new Parse.File(name, file);
            parseFile.save().then(
                function() {
                    console.log("Woot!");
                    console.log(parseFile.url());
                    $('#url').val(parseFile.url());
                    $('#pic').attr('src', parseFile.url());
                },
                function(error) {
                    console.log("Error");
                    console.dir(error);
            });
        }
    });
});
</script>